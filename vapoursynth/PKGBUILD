# Maintainer: nyfair <nyfair2012@gmail.com>
pkgname=(vapoursynth-dev vapoursynth)
pkgver=52
pkgrel=1
pkgdesc='A video processing framework with the future in mind'
arch=('x86_64')
url="http://www.vapoursynth.com/"
license=('LGPL')
source=("https://github.com/vapoursynth/vapoursynth/releases/download/R$pkgver/VapourSynth64-Portable-R$pkgver.7z")
options=(!strip)
md5sums=('SKIP')

build() {
  cd $srcdir
  rm *7z* con* ms* vc* MANIFEST* setup.py vsrepo.py
  rm -rf doc
  rm vapoursynth64/coreplugins/avisource.dll
  rm vapoursynth64/coreplugins/libimwri.dll
  rm vapoursynth64/plugins/.keep
}

package_vapoursynth-dev() {
  cd $srcdir
  mkdir -p $pkgdir/opt/include
  mv sdk/include $pkgdir/opt/include/vapoursynth
  mv sdk/lib64 $pkgdir/opt/lib
  mkdir -p $pkgdir/opt/lib/pkgconfig
  cp ../*.pc $pkgdir/opt/lib/pkgconfig
  sed -i "s/_ver/$pkgver/" $pkgdir/opt/lib/pkgconfig/vapoursynth.pc
  sed -i "s/_ver/$pkgver/" $pkgdir/opt/lib/pkgconfig/vapoursynth-script.pc
}

package_vapoursynth() {
  optdepends=('python-embed>=3.8' 'python-embed<3.9')
  export PKGEXT='.pkg.tar.xz'
  rm -rf $srcdir/sdk
  mkdir $pkgdir/opt
  mv $srcdir $pkgdir/opt/bin
}